<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H·ªá th·ªëng tra c·ª©u vƒÉn b·∫£n ph√°p lu·∫≠t</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 40px 30px;
            text-align: center;
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        header .subtitle {
            opacity: 0.95;
            font-size: 1.1em;
        }

        .content {
            padding: 40px;
        }

        .search-section {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            border-left: 5px solid #1e3c72;
            margin-bottom: 30px;
        }

        .search-section h2 {
            color: #1e3c72;
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .search-box {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .search-box input {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1.1em;
            transition: border-color 0.3s;
        }

        .search-box input:focus {
            outline: none;
            border-color: #1e3c72;
        }

        .search-box button {
            padding: 15px 40px;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .search-box button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(30, 60, 114, 0.4);
        }

        .search-box button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-box {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
        }

        .stat-box .number {
            font-size: 3em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-box .label {
            font-size: 1em;
            opacity: 0.9;
        }

        .loading {
            text-align: center;
            padding: 60px;
            font-size: 1.3em;
            color: #1e3c72;
        }

        .loading::after {
            content: '...';
            animation: dots 1.5s infinite;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }

        .results {
            margin-top: 30px;
        }

        .result-item {
            background: white;
            border: 2px solid #e0e0e0;
            border-left: 5px solid #28a745;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            transition: box-shadow 0.3s;
        }

        .result-item:hover {
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 15px;
        }

        .result-header h3 {
            color: #1e3c72;
            font-size: 1.5em;
            margin-bottom: 8px;
        }

        .file-badge {
            background: #28a745;
            color: white;
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
        }

        .result-meta {
            color: #666;
            font-size: 0.95em;
            margin-bottom: 15px;
        }

        .articles-found {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-top: 15px;
        }

        .articles-found h4 {
            color: #1e3c72;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .article-item {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 12px;
            transition: background 0.2s;
            cursor: pointer;
        }

        .article-item:hover {
            background: #e3f2fd;
        }

        .article-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .article-number {
            font-weight: bold;
            color: #1e3c72;
            font-size: 1.1em;
        }

        .article-preview {
            color: #666;
            line-height: 1.6;
            margin-top: 8px;
        }

        .article-preview mark {
            background: #ffeb3b;
            padding: 2px 5px;
            border-radius: 3px;
            font-weight: 600;
        }

        .view-detail-btn {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 600;
            transition: transform 0.2s;
        }

        .view-detail-btn:hover {
            transform: scale(1.05);
        }

        .empty-state {
            text-align: center;
            padding: 80px 20px;
            color: #999;
        }

        .empty-state h3 {
            font-size: 2em;
            margin-bottom: 15px;
        }

        .empty-state p {
            font-size: 1.1em;
        }

        footer {
            background: #f8f9fa;
            padding: 30px;
            text-align: center;
            color: #666;
            border-top: 1px solid #dee2e6;
        }

        footer a {
            color: #1e3c72;
            text-decoration: none;
            font-weight: 600;
        }

        footer a:hover {
            text-decoration: underline;
        }

        /* Document viewer page styles */
        .document-viewer {
            max-width: 1000px;
            margin: 0 auto;
            padding: 40px;
            background: white;
        }

        .document-viewer h1 {
            color: #1e3c72;
            border-bottom: 3px solid #1e3c72;
            padding-bottom: 15px;
            margin-bottom: 25px;
        }

        .document-meta {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        .document-content {
            line-height: 1.8;
            font-size: 1.05em;
            white-space: pre-wrap;
        }

        .document-content .highlight {
            background: #ffeb3b;
            padding: 3px 6px;
            border-radius: 4px;
            font-weight: 600;
            border: 2px solid #fdd835;
        }

        .back-button {
            display: inline-block;
            margin-bottom: 20px;
            padding: 10px 25px;
            background: #6c757d;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 600;
            transition: background 0.2s;
        }

        .back-button:hover {
            background: #5a6268;
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 1.8em;
            }

            .search-box {
                flex-direction: column;
            }

            .stat-box .number {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üèõÔ∏è H·ªá th·ªëng tra c·ª©u vƒÉn b·∫£n ph√°p lu·∫≠t</h1>
            <p class="subtitle">T√¨m ki·∫øm ƒëi·ªÅu kho·∫£n trong vƒÉn b·∫£n t·ª´ GitHub</p>
        </header>

        <div class="content">
            <div class="stats">
                <div class="stat-box">
                    <div class="number" id="totalFiles">0</div>
                    <div class="label">VƒÉn b·∫£n ƒë√£ t·∫£i</div>
                </div>
                <div class="stat-box">
                    <div class="number" id="totalArticles">0</div>
                    <div class="label">T·ªïng ƒëi·ªÅu kho·∫£n</div>
                </div>
                <div class="stat-box">
                    <div class="number" id="totalSearches">0</div>
                    <div class="label">L∆∞·ª£t tra c·ª©u</div>
                </div>
            </div>

            <div class="search-section">
                <h2>üîç Tra c·ª©u ƒëi·ªÅu kho·∫£n</h2>
                <div class="search-box">
                    <input 
                        type="text" 
                        id="searchInput" 
                        placeholder="Nh·∫≠p t·ª´ kh√≥a t√¨m ki·∫øm (VD: ƒëi·ªÅu 5, lao ƒë·ªông, b·∫£o hi·ªÉm...)"
                        onkeypress="if(event.key==='Enter') searchDocuments()"
                    >
                    <button id="searchBtn" onclick="searchDocuments()">
                        üîç T√¨m ki·∫øm
                    </button>
                </div>
                <p style="color: #666; font-size: 0.95em;">
                    üí° H·ªá th·ªëng s·∫Ω qu√©t to√†n b·ªô file .txt t·ª´ GitHub v√† tr·∫£ v·ªÅ c√°c ƒëi·ªÅu kho·∫£n li√™n quan
                </p>
            </div>

            <div id="results"></div>
        </div>

        <footer>
            <p><strong>H·ªá th·ªëng tra c·ª©u vƒÉn b·∫£n ph√°p lu·∫≠t</strong></p>
            <p>Ph√°t tri·ªÉn b·ªüi <a href="https://github.com/tungti28496" target="_blank">tungti28496</a></p>
            <p style="margin-top: 10px; font-size: 0.9em;">¬© 2024 - H·ªó tr·ª£ tra c·ª©u vƒÉn b·∫£n t·ª´ GitHub</p>
        </footer>
    </div>

    <script>
        // C·∫§U H√åNH GITHUB - QUAN TR·ªåNG: Thay ƒë·ªïi th√¥ng tin n√†y
        const GITHUB_CONFIG = {
            username: 'tungti28496',           // T√™n GitHub c·ªßa b·∫°n
            repository: 'tungti.github.io',    // T√™n repository
            branch: 'main',                     // Branch ch·ª©a file (th∆∞·ªùng l√† 'main' ho·∫∑c 'master')
            folder: 'documents'                 // Folder ch·ª©a file .txt (ƒë·ªÉ tr·ªëng '' n·∫øu ·ªü root)
        };

        let documents = [];
        let searchCounter = 0;

        // Load data when page loads
        window.addEventListener('load', async () => {
            await loadDocumentsFromGitHub();
            loadSearchCounter();
        });

        // Load search counter from localStorage
        function loadSearchCounter() {
            const saved = localStorage.getItem('searchCounter');
            if (saved) {
                searchCounter = parseInt(saved);
                document.getElementById('totalSearches').textContent = searchCounter;
            }
        }

        // Save search counter
        function saveSearchCounter() {
            localStorage.setItem('searchCounter', searchCounter.toString());
        }

        // Load documents from GitHub
        async function loadDocumentsFromGitHub() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<div class="loading">‚è≥ ƒêang t·∫£i vƒÉn b·∫£n t·ª´ GitHub</div>';

            try {
                const folder = GITHUB_CONFIG.folder ? `/${GITHUB_CONFIG.folder}` : '';
                const apiUrl = `https://api.github.com/repos/${GITHUB_CONFIG.username}/${GITHUB_CONFIG.repository}/contents${folder}?ref=${GITHUB_CONFIG.branch}`;
                
                const response = await fetch(apiUrl);
                if (!response.ok) {
                    throw new Error('Kh√¥ng th·ªÉ t·∫£i danh s√°ch file t·ª´ GitHub');
                }

                const files = await response.json();
                const txtFiles = files.filter(file => file.name.endsWith('.txt'));

                if (txtFiles.length === 0) {
                    resultsDiv.innerHTML = `
                        <div class="empty-state">
                            <h3>üì≠ Ch∆∞a c√≥ vƒÉn b·∫£n n√†o</h3>
                            <p>H√£y th√™m file .txt v√†o folder "${GITHUB_CONFIG.folder || 'root'}" trong repository c·ªßa b·∫°n</p>
                        </div>
                    `;
                    return;
                }

                // Load content of each file
                for (const file of txtFiles) {
                    try {
                        const contentResponse = await fetch(file.download_url);
                        const content = await contentResponse.text();
                        
                        const articles = extractArticles(content);
                        
                        documents.push({
                            name: file.name.replace('.txt', ''),
                            fileName: file.name,
                            url: file.html_url,
                            downloadUrl: file.download_url,
                            content: content,
                            articles: articles
                        });
                    } catch (error) {
                        console.error(`Error loading ${file.name}:`, error);
                    }
                }

                updateStats();
                resultsDiv.innerHTML = `
                    <div class="empty-state">
                        <h3>‚úÖ ƒê√£ t·∫£i ${documents.length} vƒÉn b·∫£n</h3>
                        <p>Nh·∫≠p t·ª´ kh√≥a v√†o √¥ t√¨m ki·∫øm ƒë·ªÉ b·∫Øt ƒë·∫ßu tra c·ª©u</p>
                    </div>
                `;

            } catch (error) {
                resultsDiv.innerHTML = `
                    <div class="empty-state">
                        <h3>‚ùå L·ªói khi t·∫£i vƒÉn b·∫£n</h3>
                        <p>${error.message}</p>
                        <p style="margin-top: 15px; font-size: 0.9em;">
                            Ki·ªÉm tra l·∫°i c·∫•u h√¨nh GITHUB_CONFIG trong code
                        </p>
                    </div>
                `;
            }
        }

        // Extract articles from content
        function extractArticles(content) {
            const articles = [];
            
            const patterns = [
                {
                    regex: /ƒêi·ªÅu\s+(\d+)[.:]\s*([^\n]+(?:\n(?!ƒêi·ªÅu\s+\d+)[^\n]+)*)/gi,
                    type: 'article',
                    label: 'ƒêi·ªÅu'
                },
                {
                    regex: /Kho·∫£n\s+(\d+)[.:]\s*([^\n]+(?:\n(?!Kho·∫£n\s+\d+)[^\n]+)*)/gi,
                    type: 'clause',
                    label: 'Kho·∫£n'
                },
                {
                    regex: /ƒêi·ªÉm\s+([a-z])[.):]\s*([^\n]+)/gi,
                    type: 'point',
                    label: 'ƒêi·ªÉm'
                }
            ];

            patterns.forEach(pattern => {
                const regex = new RegExp(pattern.regex);
                let match;
                while ((match = regex.exec(content)) !== null) {
                    const startPos = match.index;
                    const endPos = Math.min(startPos + 500, content.length);
                    const context = content.substring(startPos, endPos);

                    articles.push({
                        type: pattern.type,
                        label: pattern.label,
                        number: match[1],
                        title: match[2].trim(),
                        content: context,
                        position: match.index,
                        fullMatch: match[0]
                    });
                }
            });

            return articles;
        }

        // Search in documents
        function searchDocuments() {
            const query = document.getElementById('searchInput').value.trim();
            
            if (!query) {
                alert('‚ö†Ô∏è Vui l√≤ng nh·∫≠p t·ª´ kh√≥a t√¨m ki·∫øm!');
                return;
            }

            if (documents.length === 0) {
                alert('‚ö†Ô∏è Ch∆∞a c√≥ vƒÉn b·∫£n n√†o ƒë∆∞·ª£c t·∫£i!');
                return;
            }

            const searchBtn = document.getElementById('searchBtn');
            searchBtn.disabled = true;
            searchBtn.textContent = '‚è≥ ƒêang t√¨m...';

            searchCounter++;
            saveSearchCounter();
            document.getElementById('totalSearches').textContent = searchCounter;

            setTimeout(() => {
                const results = searchInDocuments(query);
                displayResults(results, query);
                searchBtn.disabled = false;
                searchBtn.textContent = 'üîç T√¨m ki·∫øm';
            }, 500);
        }

        // Search in all documents
        function searchInDocuments(query) {
            const results = [];
            const lowerQuery = query.toLowerCase();

            documents.forEach(doc => {
                const matchingArticles = doc.articles.filter(article => 
                    article.content.toLowerCase().includes(lowerQuery) ||
                    article.title.toLowerCase().includes(lowerQuery)
                );

                if (matchingArticles.length > 0) {
                    results.push({
                        document: doc,
                        matches: matchingArticles
                    });
                }
            });

            return results;
        }

        // Display search results
        function displayResults(results, query) {
            const resultsDiv = document.getElementById('results');

            if (results.length === 0) {
                resultsDiv.innerHTML = `
                    <div class="empty-state">
                        <h3>üòï Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£</h3>
                        <p>Kh√¥ng t√¨m th·∫•y ƒëi·ªÅu kho·∫£n n√†o ch·ª©a t·ª´ kh√≥a "<strong>${query}</strong>"</p>
                        <p style="margin-top: 10px; font-size: 0.95em;">üí° Th·ª≠ t√¨m ki·∫øm v·ªõi t·ª´ kh√≥a kh√°c</p>
                    </div>
                `;
                return;
            }

            let html = `<h2 style="color: #28a745; margin-bottom: 25px; font-size: 1.8em;">
                ‚úÖ T√¨m th·∫•y ${results.length} vƒÉn b·∫£n c√≥ ch·ª©a "${query}"
            </h2>`;

            results.forEach((result, index) => {
                const doc = result.document;
                const matches = result.matches;

                html += `
                    <div class="result-item">
                        <div class="result-header">
                            <div>
                                <h3>${doc.name}</h3>
                                <div class="result-meta">
                                    üìÑ File: ${doc.fileName} | üéØ ${matches.length} ƒëi·ªÅu kho·∫£n kh·ªõp
                                </div>
                            </div>
                            <span class="file-badge">üìÅ .txt</span>
                        </div>

                        <div class="articles-found">
                            <h4>üìç C√°c ƒëi·ªÅu kho·∫£n t√¨m th·∫•y:</h4>
                `;

                matches.slice(0, 10).forEach((article, idx) => {
                    const preview = highlightText(article.content.substring(0, 300), query);
                    
                    html += `
                        <div class="article-item">
                            <div class="article-header">
                                <span class="article-number" onclick="viewArticle('${encodeURIComponent(doc.fileName)}', ${article.position}, '${article.label}', '${article.number}')" style="cursor: pointer; user-select: none;" title="Click ƒë·ªÉ xem ${article.label} ${article.number}">
                                    üìå ${article.label} ${article.number}
                                </span>
                                <button class="view-detail-btn" onclick="viewDocument('${encodeURIComponent(doc.fileName)}', '${query}', ${article.position})">
                                    üëÅÔ∏è Xem chi ti·∫øt
                                </button>
                            </div>
                            <div class="article-preview">
                                ${preview}${article.content.length > 300 ? '...' : ''}
                            </div>
                        </div>
                    `;
                });

                if (matches.length > 10) {
                    html += `<p style="color: #666; font-style: italic; margin-top: 10px;">
                        ... v√† ${matches.length - 10} ƒëi·ªÅu kho·∫£n kh√°c
                    </p>`;
                }

                html += `
                        </div>
                    </div>
                `;
            });

            resultsDiv.innerHTML = html;
        }

        // Highlight search term
        function highlightText(text, query) {
            if (!query) return text;
            const regex = new RegExp(`(${escapeRegex(query)})`, 'gi');
            return text.replace(regex, '<mark>$1</mark>');
        }

        // Escape regex special characters
        function escapeRegex(string) {
            return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        }

        // View document detail
        function viewDocument(fileName, query, position) {
            const doc = documents.find(d => d.fileName === decodeURIComponent(fileName));
            if (!doc) return;

            // Save to sessionStorage to pass to view page
            sessionStorage.setItem('currentDocument', JSON.stringify({
                doc: doc,
                query: query,
                position: position
            }));

            // Navigate to view page
            window.location.href = 'view.html';
        }

        // Update statistics
        function updateStats() {
            document.getElementById('totalFiles').textContent = documents.length;
            
            let totalArticles = 0;
            documents.forEach(doc => {
                totalArticles += doc.articles.length;
            });
            document.getElementById('totalArticles').textContent = totalArticles;
        }
    </script>
</body>
</html>
